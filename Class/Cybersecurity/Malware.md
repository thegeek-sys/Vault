---
Class: "[[Cybersecurity]]"
Related:
---
---
## Introduction

>[!quote] NIST 800-83 defines malware as
>”a program that is inserted into a system usually covertly, with the intent of compromising the confidentiality, integrity, or availability of the victim’s data, applications, or operating system or otherwise annoying or disrupting the victim”

---
## Classification of malware
The malwares can be classified into two broad categories:
- based first on how it spreads or propagates to reach the desired target
- then on the actions or the payload it performs once a target is reached

But can also be classified by:
- those that need a program (parasitic code such as viruses)
- those that are independent, self-contained programs (worms, trojans and bots)
- malware that does not replicate (trojans and spam email)
- malware that does replicate (viruses and worms)

### Types of malicious software
Propagation mechanisms include:
- infection of existing content by viruses that is subsequently spread to other systems
- exploit of software vulnerabilities by worms or drive-by-downloads to allow the malware to replicate
- social engineering attacks that convince users to bypass security systems mechanisms to install trojans or to respond to phishing attacks

Payload actions performed by malware once it reaches a target system can include:
- corruption of system or data files
- theft of service/make the system a zombie agent of attack as part of a botnet
- theft of information from the system/keylogging
- hiding its presence on the system

---
## Attack kits
Initially the development and deployment of malware required considerable technical skill by software authors. But the development of virus-creation toolkits in the early 1990s and then more general attack kits in the 2000s made easier for everyone to create malware.

Toolkits are often known as *crimeware* and include a variety of propagation mechanisms and payload modules that even novices can deploy, but the problem for the defending systems comes when also variants can be generates by attacker using those same toolkits

>[!example]
>- zeus
>- angler

---
## Attack sources
Another significant malware development is the change from attackers being individuals often motivated to demonstrate their technical competence to more organized and dangerous attack sources such as:
- politically motivated attackers
- criminals
- organized crime
- organizations that sell their services to companies and nations
- national government agencies

This has significantly changed the resources available and motivation behind the rise of malware and has led to  development of a large underground economy involving the sale of attack kits and access to compromised hosts and stolen information

### Advanced Persistent Threats (APTs)
The **Advanced Persistent Threats** are well-resourced, persistent application of a wide variety of intrusion technologies and malware to selected targets (usually business or political). Those are typically attributed to state-sponsored organizations and criminal enterprises.

They differ from other types of attack by their careful target selection and stealthy intrusion efforts over extended periods. High profile attacks include Aurora, RSA, APT1, and Stuxnet

>[!info] APT characteristics
>##### Advanced
>Used by attackers of a wide variety of intrusion technologies and malware including the development of custom malware if required
>
>The individual components may not necessarily be technically advanced but are careful selected to suit the chosen target
>
>##### Persistent
>Determined application of the attacks over and extended period against the chosen target in order to maximize the change of success. A variety of attacks may be progressively applied until the target is compromised
>
>##### Threats
>Threats to the selected targets as a result of the organized, capable, and wall-funded attackers intent to compromise the specifically chosen targets.
>
>The active involvement of people in the process greatly raises the threat level from that due to automated attacks tools, and also the likelihood of successful attacks

#### APT attacks
- **aim** → varies from theft of intellectual property or security and infrastructure related data to the physical disruption of infrastructure
- **techniques used** → social engineering, spear-phishing email, drive-by-downloads from selected compromised websites likely to be visited by personnel in the target organization
- **intent** → to infect the target with sophisticated malware with multiple propagation mechanisms and payloads; once they have gained initial access to systems in the target organization a further range of attack tools are used to maintain and extend their access

---
## Viruses
A **virus** is a piece of software that infects programs and:
- modifies them to include a copy of the virus
- replicates and goes on to infect other content
- easily spread through network environment

When attached to an executable program, a virus can do anything that the program is permitted to do (executes secretly when the host program is run) and they are specific to operating system and hardware

### Virus components
A virus consists of three components:
- **infection mechanism** → means by which a virus spreads or propagates (also referred to as the *infection vector*)
- **trigger** → event/condition that determines when the payload is activated or delivered (known as *logic bomb*)
- **payload** → what the virus does (besides spreading); may involve damage or benign but noticeable activity

### Virus phases
![[Pasted image 20251110143021.png]]

### Macro and scripting viruses

>[!quote] NISTIR 7298 defines a macro virus as
>“a virus that attaches itself to documents and uses the macro programming capabilities of the document’s application to execute and propagate”

Macro viruses infect scripting code used to support active content in a variety of use document types

Those can be more threatening than normal viruses for several reasons:
- is platform independent
- infect documents, not executable portions of code
- are easily spread
- because they infect user documents rather than system programs, traditional file system access controls are of limited use in preventing their spread, since users are expected to modify them
- are much easier to write or to modify than traditional executable viruses

>[!example] Melissa macro virus pseudo-code
>```
>macro Document_Open
>	disable Macro menu and some macro security features
>	if called from a user document
>		copy macro code into Normal template file
>	else
>		copy macro code into user document being opened
>	end if
>	if registry key "Melissa" not present
>		if Outlook is email client
>			for first 50 addresses in address book
>				send email to that addresses with 
>				currently infected document attached
>			end for
>		end if
>		create registry key "Melissa"
>	end if
>	if minute in hour equals day of month
>		inser text into document being opened
>	end if
>end macro
>```

### Viruses classification by target
- **boot sector infector** → infects a master boot record or boot record and spreads when a system is booted from the disk containing the virus
- **file infector** → infects files that the operating system or shell considers to be executable
- **macro virus** → infects files with macro or scripting code that is interpreted by an application
- **multipartite virus** → infects files in multiple ways

### Viruses classification by concealment strategy
- **encrypted virus** → a portion of the virus creates a random encryption key and encrypts the remainder of the virus
- **stealth virus** → a form of virus explicitly designed to hide itself from detection by anti-virus software
- **polymorphic virus** → a virus that mutates with every infection
- **metamorphic virus** → a virus that mutates and rewrites itself completely at each iteration and may change behavior as well as appearance

---
## Worms
A **worm** is a program that actively seeks out more machines to infect and each infected machine serves as an automated launching pad for attacks on other machines by exploiting software vulnerabilities in client or server programs.

It can use network connections or shared media (USB drives, CD, DVD data disks) to spread from system to system. Email worms spread in macro or script code included in attachments and instant messenger file transfer.

Upon activation the worm may replicate and propagate again and usually carries some form of payload.

>[!example]
>First known implementation was done in Xerox Palo Alto Labs in the early 1980s

### Worm replication
It can replicate in various ways:
- electronic mail or instant messenger facility → worms emails a copy of itself to other systems or sends itself as an attachment via an instant message service
- file sharing → creates a copy of itself or infects a file as a virus on removable media
- remote execution capability → worm executes a copy of itself on another system
- remote file access or transfer capability → worm uses a remote file access to transfer service to copy itself from one system to the other
- remote login capability → worm logs onto a remote system as a user and then uses commands to copy itself from one system to the other

### Target discovery
- **scanning** (or fingerprinting) → first function in the propagation phase for a network work; it searches for other systems to infect
- **random** → each compromised host probes random addresses in the IP address space using a different seed; this produces a high volume of Internet traffic, which may cause generalized disruption even before the actual attack is launched
- **hit-list** → the attacker first compiles a long list of potential vulnerable machines and once done, the attacker begins infecting machines on the list; each infected machine is provided with a portion of the list to scan, it results in a very short scanning period which may make it difficult to detect that infection is taking place
- **topological** → this method uses information contained on an infected victim machine to find more hosts to scan
- **local subnet** → if a host can be infected behind a firewall that host then looks for targets in its own local network; the host uses the subnet address structure to find other hosts that would otherwise be protected by the firewall

### Worm propagation model
![[Pasted image 20251110224332.png]]

### Worm technology
![[Pasted image 20251110231335.png]]

### Examples
#### Morris worm
The morris worm is the earliest worm infection and it has been released by Robert Morris in 1988. It was designed to spread in UNIX systems by attempting to crack local password file to use login/password to logon to other systems.
It exploited a bug in the finger protocol which reports the whereabouts of a remote user and a trapdoor in the debug option of the remote process that receives and sends mail

Successful attacks achieved communication with the operating system command interpreter (sent interpreter a bootstrap program to copy worm over)

#### Recent worm attacks

| Name                 | Year           | Description                                                                                                               |
| -------------------- | -------------- | ------------------------------------------------------------------------------------------------------------------------- |
| Melissa              | 1998           | e-mail worm. First to include worm, virus and Trojan in one package                                                       |
| Code Red             | July 2001      | exploited Microsoft IIS bug; probes random IP addresses; consumes significant Internet capacity when active               |
| Code Red II          | August 2001    | also targeted Microsoft IIS; installs a backdoor for access                                                               |
| Nimda                | September 2001 | had worm, virus and mobile code characteristics. Spread using e-mail, Windows shares, Web servers, Web clients, backdoors |
| SQL Slammer          | Early 2003     | exploited a buffer overflow vulnerability in SQL server; compact and spread rapidly                                       |
| Sobig.F              | Late 2003      | exploited open proxy servers to turn infected machines into spam engines                                                  |
| Mydoom               | 2004           | mass-mailing e-mail worm; installed a backdoor in infected machines                                                       |
| Warezov              | 2006           | creates executables in system directories; sends itself as an e-mail attachment; can disable security related products    |
| Conficker (Downadup) | November 2008  | exploits a Windows buffer overflow vulnerability; most widespread infection since SQL Slammer                             |
| Stuxnet              | 2010           | restricted rate of spread to reduce chance of detection; targeted industrial control systems                              |

---
## Mobile code

>[!quote] NIST SP 800-28 defines mobile code as
>“programs that can be shipped unchanged to a heterogeneous collection of platforms and executed with identical semantics”

Mobile code is transmitted from a remote  system to a local system and then executed on the local system and often acts as a mechanism for a virus, worm or Trojan horse.
Usually it takes advantage of vulnerabilities to perform its own exploits.

Popular vehicles include:
- Java applets
- ActiveX
- JavaScript
- VBScript

Most common ways of using mobile code for malicious operations on local system are:
- cross-site scripting
- interactive and dynamic Web sites
- e-mail attachments
- downloads from untrusted sites or of untrusted software

### Mobile phone worms
The first mobile phone worm discovered was Cabir worm in 2004, then Lasco and CommWarrior in 2005. They used to communicate through Bluetooth wireless connections or MMS (CommWorrior replicates by means of Bluetooth to the phones, sends itself as an MMS file to contacts and as an auto reply to incoming text messages)

The target in this case is the smartphone and can completely disable the phone, delete data on the phone, or force the deice to send costly messages.
Although these examples demonstrate that mobile phone worms are possible, the vast majority of mobile phone malware observed use **trojan apps** to install themselves.

---
## Drive-by-downloads
![[Pasted image 20251110233221.png|center|400]]

Drive-by-downloads attacks exploit browser and plugin vulnerabilities making the user view a webpage controlled by the attacker that contains code that exploits the but to download and install malware on the system without the user’s knowledge or consent (e.g. Adobe Flash, Oracle Java)

In most cases the malware does not actively propagate as a worm does but it spreads when users visit the malicious webpage

### Watering-hole attacks
Watering-hole attacks are a variant of drive-by-dowload used in highly targeted attacks.
In this case the attacker researches their intended victims to identify websites they are likely to visit, then scans there sites to identify those with vulnerabilities that allow their compromise. They then wait for one of their intended victims to visit one of the compromised sites.

Attack code may even be written so that it will only infect systems belonging to the target organization and take no action for other visitors to the site. This greatly increases the likelihood of the compromise remaining undetected

### Malvertising
Places malwares on websites without actually compromising them. In fact the attacker pays for advertisements that are highly likely to be places on their intended target websites and incorporate malware in them. By using these malicious ads, attackers can infect visitors to sites displaying them.

The malware code may be dynamically generated to either place on desired websites with few questions asked and are hard to track. Attackers can place these ads for as little as a few hours, when they expect their intended victims to be browsing the targeted websites, greatly reducing their visibility.

### Clickjacking
This attack is also known as a user-interface **redress attacks**. It consists of a vulnerability used by an attacker to collect an infected user’s click.
The attacker can force the user to do a variety of things from adjusting the user’s computer settings to unwittingly sending the user to websites that might have malicious code. By taking advantage of Adobe Flash or Javascript an attacker could even place a button under or over a legitimate button making it difficult for user to detect.

A typical attack uses multiple transparent or opaque layers to trick a user into clicking on a button or link on another page when they were intending to click on the top level page (attacker is hijacking clicks meant for one page and routing them to another page)

By using a similar technique, keystrokes can also be hijacked. A user can be lead to believe they are typing in the password to their email or bank account, but instead they are typing into an invisible frame controlled by the attacker

---
## Social engineering for malware propagation
Social engineering consist of tricking users to assist in the compromise of their own systems. There are three main types of attacks of this kind:
- spam → has a significant carrier of malware and is used for phishing attacks
- trojan horse → program or utility containing harmful hidden code and is used to accomplish functions that the attacker could not accomplish directly
- mobile phone trojans → same as previous but the target is the smartphone

---
## Ransomware
A ransomware encrypts the user’s data and demands payment in order to access the key needed to recover the information. The first example is PC Cyborg Trojan (1989)

One of the biggest attacks was in mid-2006 a number of worms and Trojans appeared that
used public-key cryptography with increasingly larger key sizes to encrypt data. The user needed to pay a ransom, or to make a purchase from certain sites, in order to receive the key to decrypt this data.

### WannaCry
Wannacry is a ransomware attack in May 2017 that spread extremely fast over a period of hours to days, infecting hundreds of thousands of systems belonging to both public and private organizations in more that 150 countries.

It spread as a worm by aggressively scanning both local and random remote networks, attempting to exploit a vulnerability in the SMB file sharing service on unpatched Windows systems. This rapid spread was only slowed by the accidental activation of a “kill-switch” domain by a UK security researcher

Once installed on infected systems, it also encrypted files, demanding a random payment to recover them. Tactics such as threatening to publish sensitive personal information, or to permanently destroy the encryption key after a short period of time, are sometimes used to increase the pressure on the victim to pay up

## Payload
### System corruption
System corruption malware can cause real-world damage, sometimes even affecting physical equipment. One example is the Chernobyl virus, which was notorious for rewriting BIOS code and rendering computers unusable. Another example is the Stuxnet worm, which was specifically designed to target industrial control systems, demonstrating how malware can be used for industrial sabotage. These cases have raised serious concerns about the potential use of advanced, targeted malware to disrupt or damage critical infrastructure.

Another form of malicious code is known as a logic bomb. This is a piece of code hidden within a program that is designed to “explode” or activate when certain conditions are met (such as a specific date, event, or system trigger) causing harm or disruption to the affected system.

#### Examples

>[!example] Chernobyl virus
>It was first seen in 1988 and is an example of a destructive parasitic memory-resident Windows 95 and 98 virus.
>
>It infects executable files when they are opened and when a trigger date is reached, the virus deletes data on the infected system by overwriting the first megabyte of the hard drive with zeros, resulting in massive corruption of the entire system.

>[!example] Klez
>It is a mass mailing worm that can infects Windows machines from 95 up to XP and was first seen in October 2001.
>
>It spreads by emailing copies of itself to addresses found in the address book and in files of the system and it can stop and delete some anti-virus programs running on the system. On trigger data causes files on the hard drive to become  empty.

### Attack agents bots
This kind of attack takes over another Internet attached and uses that computer to launch or manage attacks, crating a *botnet*, a collection of bots capable of acting in a coordinated manner.
It uses:
- distributed denial-of-service (DDoS) attacks
- spamming
- sniffing traffic
- keylogging
- spreading new malware
- installing advertisement add-ons and browser helper objects (BHOs)
- attacking IRC chat networks
- manipulating online polls/games

>[!info] Remote Control Facility (C&C)
>It distinguishes a bot from a worm:
>- a worm propagates itself and activates itself
>- a bot is initially controlled from some central facility
>
>A common method for implementing remote-control functionality is to use an IRC server as the command-and-control channel so that bots join a specific channel on this server and treat incoming messages as commands.
>
>More recent botnets use covert communication channels that rely on protocols such as HTTP to blend in with normal web traffic. To improve resilience, many now use distributed control mechanisms based on peer-to-peer (P2P) protocols, which help avoid a single point of failure. In addition, some malware families employ advanced techniques like automatically generating large numbers of potential server domain names, allowing the malware to continually attempt to contact command servers even if many of those domains are blocked or taken down.

### Information theft
#### Keyloggers
Captures keystrokes to allow attacker to monitor sensitive information. A keylogger typically uses some form of filtering mechanism that only returns information close to keywords (“login”, “password“).

#### Spyware
A spyware subverts the compromised machine to allow monitoring of a wide range of activity the system (like monitoring history and content of browsing activity). It can also redirect certain webpage requests to fake sites and dynamically modify data exchange between the browser and certain websites of interest

#### Phishing
Exploits social engineering to leverage the user’s trust by masquerading as communication from a trusted source. A typical flow of attack:
- include a URL in a spam e-mail that links to a fake website that mimics the login page of a banking, gaming or similar site
- suggests that urgent action is required by the user to authenticate their account
- attacker exploits the account using the captured credentials

**Spear-phishing** is an alternative to phishing. It uses recipients carefully researched by the attacker and the email is crafted to specifically suit its recipient, often quoting a range of information to convince them of its authenticity. To sum it up it is a customized attack on a specific employee and company

### Stealthing
#### Backdoor
Also known as *trapdoor*, is a secret entry point into a program allowing the attacker to gain access and bypass the security access procedures, but it’s difficult to implement operating system controls for backdoors in applications.

A *maintenance hook* is a backdoor used by programmers to debug and test programs.

#### Rootkit
A rootkit is a set of hidden programs installed on a system to maintain covert access to that system. It hides by subverting the mechanisms that monitor and report on the processes, files, and registries on a computer.

![[Pasted image 20251111115730.png|center|350]]

It also gives root privileges to attacker. Rootkits have different classification characteristics:
- persistent
- user mode
- memory based
- kernel mode
- virtual machine based
- external mode

>[!example] System call table modification example
>![[Pasted image 20251111120321.png]]

---
## Malware countermeasure approaches
The ideal solution to the thread of malware is prevention. There are four main elements of prevention:
- policy
- awareness
- vulnerability mitigation
- threat mitigation

If prevention fails, technical mechanisms can be used to support the following thread mitigation options:
1. detection
2. identification
3. removal

>[!info] Generations of anti-virus software
>###### First generation: simple scanners
>Requires a malware signature to identify the malware. Limited to the detection of known malware
>###### Second generation: heuristic scanners
>Uses heuristic rules to search for probable malware instances, or uses integrity checking
>###### Third generation: activity traps
>Those are memory-resident programs that identify malware by its actions rather than its structure in an infected program
>###### Fourth generation: full-featured protection
>Those are packages consisting of a variety of anti-virus techniques use in conjunction, including scanning and activity trap components and access control capability

### Sandbox analysis
A sandbox analysis consists of running potentially malicious code in an emulated sandbox or on a virtual machine. It allows the code to be executed in a controlled environment where its  behavior can be closely monitored without threatening the security of a real system.

Running potentially malicious software in such environments enables the detection of complex encrypted, polymorphic, or metamorphic malware, but the most difficult design issue with sandbox analysis is to determine how long to run each interpretation

### Host-based behavior-blocking software
This kind of software integrates with the operating system on a host computer and monitors program behavior in real time for malicious action. In particular they:
- block potentially malicious actions before they have a chance to affect the system
- block software in real time so it has an advantage over anti-virus detection techniques such as fingerprinting or heuristic

But it has limitations, in fact malicious code must run on the target machine before all its behaviors can be identified, and it can cause harm before it has been detected and blocked

### Perimeter scanning approaches
Those are antivirus software typically included in e-mail and Web proxy services running on an organization’s firewall and IDS.

It may also be included in the traffic analysis component of an IDS, and may include intrusion prevention measures, blocking the flow of any suspicious traffic but the approach is limited to scanning malware.

There are two types of monitoring software:
- **ingress monitoring** → located at the border between the enterprise network and the Internet; one technique is to look for incoming traffic to unused local IP addresses
- **egress monitors** → located at the egress point of individual LAN as well as at the border between the enterprise network and the Internet; it monitors outgoing traffic for signs of scanning or other suspicious behavior
